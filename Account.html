<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EASTWEST Shuttle</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="styles/logo.webp" type="image/webp">
</head>

<body class="dashboard">

<!-- SIDEBAR -->
<aside class="sidebar">
    <div class="logo">EastWest Shuttle</div>

    <ul class="menu">
        <li>
            <a href="dashboard.html"><strong>Dashboard</strong></a>
        </li>

        <li class="active">
            <a href="accounts.html">Accounts</a>
        </li>

        <li>
            <div class="dropdown-btn" onclick="toggleDropdown('shuttleMenu')">
                Shuttle ▾
            </div>
            <ul class="dropdown-menu" id="shuttleMenu">
                <li><a href="shuttle.html?id=1">Shuttle 1</a></li>
                <li><a href="shuttle.html?id=2">Shuttle 2</a></li>
                <li><a href="shuttle.html?id=3">Shuttle 3</a></li>
            </ul>
        </li>

        <li>
            <a href="daily_records.html">Records</a>
        </li>
    </ul>
</aside>

<!-- MAIN -->
<div class="main">

    <!-- TOPBAR -->
    <header class="topbar">
        <div class="user-dropdown">
            <button class="user-btn" onclick="toggleUserMenu()">John Doe ▾</button>
            <ul class="user-menu" id="userMenu">
                <li>Edit Account</li>
                <li>Logout</li>
            </ul>
        </div>
    </header>

    <!-- CONTENT -->
    <main class="content">

        <!-- ADD ACCOUNT BUTTON -->
        <div class="actions-bar">
            <button class="primary-btn" onclick="openAddModal()">Add Account</button>
        </div>

        <!-- ACCOUNTS TABLE -->
        <section class="chart-box">
            <h4>All Accounts</h4>

            <table id="accountsTable">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

    </main>
</div>

<!-- ADD ACCOUNT MODAL -->
<div class="modal" id="addAccountModal">
    <div class="auth-card">
        <h1>Add Account</h1>

        <div class="form-group">
            <label>Username</label>
            <input type="text" id="addUsername" placeholder="Enter username">
        </div>

        <div class="form-group">
            <label>Role</label>
            <select id="addRole">
                <option value="" disabled selected>Select a role</option>
                <option value="Admin">Admin</option>
                <option value="Super Admin">Super Admin</option>
                <option value="Dispatcher">Dispatcher</option>
            </select>
        </div>

        <div class="form-group">
            <label>Password</label>
            <input type="password" id="addPassword" placeholder="••••••••">
        </div>

        <div class="form-group">
            <label>Confirm Password</label>
            <input type="password" id="addConfirmPassword" placeholder="••••••••">
        </div>

        <button class="prime-btn" onclick="addAccount()">Add Account</button>
        <button class="secondary-btn" onclick="closeAddModal()">Cancel</button>
    </div>
</div>
<!-- JS -->
<script>
let accounts = [];

function toggleDropdown(id) {
    const menu = document.getElementById(id);
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function toggleUserMenu() {
    const menu = document.getElementById("userMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function openAddModal() {
    document.getElementById("addAccountModal").style.display = "flex";
}

function closeAddModal() {
    document.getElementById("addAccountModal").style.display = "none";
}

function addAccount() {
    const username = document.getElementById("addUsername").value;
    const role = document.getElementById("addRole").value;
    const pass = document.getElementById("addPassword").value;
    const confirm = document.getElementById("addConfirmPassword").value;

    if (!username || !role || !pass || !confirm) {
        alert("Fill all fields");
        return;
    }

    if (pass !== confirm) {
        alert("Passwords do not match");
        return;
    }

    accounts.push({ username, role });
    renderAccounts();
    closeAddModal();
}

function renderAccounts() {
    const tbody = document.querySelector("#accountsTable tbody");
    tbody.innerHTML = "";

    accounts.forEach((acc, index) => {
        tbody.innerHTML += `
            <tr>
                <td>${acc.username}</td>
                <td>${acc.role}</td>
                <td>
                    <button class="delete" onclick="deleteAccount(${index})">Delete</button>
                    <button class="update" onclick="updateAccount(${index})">Update</button>
                </td>
            </tr>
        `;
    });
}

function deleteAccount(index) {
    if (confirm("Delete account?")) {
        accounts.splice(index, 1);
        renderAccounts();
    }
}

let currentIndex = null; // Track which index we are editing

function updateAccount(index) {
    currentIndex = index;
    const acc = accounts[index];

    // Populate the modal fields with existing data
    document.getElementById("editUsername").value = acc.username;
    document.getElementById("editRole").value = acc.role;

    // Show the modal and overlay
    document.getElementById("updateModal").style.display = "block";
    document.getElementById("modalOverlay").style.display = "block";
}

function saveUpdate() {
    const newUsername = document.getElementById("editUsername").value;
    const newRole = document.getElementById("editRole").value;

    if (newUsername.trim() !== "") {
        // Update the array
        accounts[currentIndex] = {
            username: newUsername.trim(),
            role: newRole
        };

        closeModal();
        renderAccounts(); // Refresh the table
    } else {
        alert("Username cannot be empty");
    }
}

function closeModal() {
    document.getElementById("updateModal").style.display = "none";
    document.getElementById("modalOverlay").style.display = "none";
}
</script>
<div id="modalOverlay" onclick="closeModal()"></div>

<div id="updateModal">
    <h3>Update User</h3>
    
    <label for="editUsername">Username</label>
    <input type="text" id="editUsername">

    <label for="editPassword">New Password</label>
    <input type="password" id="editPassword" placeholder="Enter new password">
    
    <label for="editRole">Role</label>
    <select id="editRole">
        <option value="Admin">Admin</option>
        <option value="Super Admin">Super Admin</option>
        <option value="Dispatcher">Dispatcher</option>
    </select>
    
    <div class="modal-buttons">
        <button class="btn-cancel" onclick="closeModal()">Cancel</button>
        <button class="btn-save" onclick="saveUpdate()">Save Changes</button>
    </div>
</div>
</body>
</html>
